---

  - name: Wireguard
    connection: ssh
    gather_facts: yes
    hosts: rpi
    tasks:
      - name: enable unstable
        lineinfile:
          path: /etc/apt/sources.list.d/unstable-wireguard.list
          create: yes
          line: deb http://deb.debian.org/debian/ unstable main
        become_user: root
        become: yes
      - name: enable wireguard repo
        blockinfile:
          path: /etc/apt/preferences.d/limit-unstable
          create: yes
          block: |
            Package: *
            Pin: release a=unstable
            Pin-Priority: 150

        become_user: root
        become: yes
      - name: Install deps
        apt:
          pkg:
            - wireguard-dkms
            - wireguard-tools
            - resolvconf
          update_cache: yes
        become_user: root
        become: yes
